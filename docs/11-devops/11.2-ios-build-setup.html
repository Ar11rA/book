
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>iOS Build setup ¬∑ GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="11.3-ci-setup.md" />
    
    
    <link rel="prev" href="11.1-android-build-setup.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../3-react-native-internals/3.1-react-native-internals.html">
            
                <a href="../3-react-native-internals/3.1-react-native-internals.html">
            
                    
                    React Native Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../4-setting-up-the-project/4.1-installing-react-native.html">
            
                <a href="../4-setting-up-the-project/4.1-installing-react-native.html">
            
                    
                    Setting up the project
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Start building the app</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../5-project-structure-and-start-building-some-app/5.0-intro.html">
            
                <a href="../5-project-structure-and-start-building-some-app/5.0-intro.html">
            
                    
                    Project Structure
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../5-project-structure-and-start-building-some-app/5.1-customising-the-structure.html">
            
                <a href="../5-project-structure-and-start-building-some-app/5.1-customising-the-structure.html">
            
                    
                    Customizing the project structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../5-project-structure-and-start-building-some-app/5.2-basic-components-and-platform-specific-code.html">
            
                <a href="../5-project-structure-and-start-building-some-app/5.2-basic-components-and-platform-specific-code.html">
            
                    
                    Creating basic components and writing platform specific code
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../6-conventions-and-code-style/6.0-intro.html">
            
                <a href="../6-conventions-and-code-style/6.0-intro.html">
            
                    
                    Coventions and Code Style
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../6-conventions-and-code-style/6.1-eslint.html">
            
                <a href="../6-conventions-and-code-style/6.1-eslint.html">
            
                    
                    Eslint : The guardian of code conventions ‚öîÔ∏è
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../6-conventions-and-code-style/6.2-git-pre-hooks.html">
            
                <a href="../6-conventions-and-code-style/6.2-git-pre-hooks.html">
            
                    
                    Github Pre-push/Pre-commit Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../6-conventions-and-code-style/6.3-environment-variables.html">
            
                <a href="../6-conventions-and-code-style/6.3-environment-variables.html">
            
                    
                    Environment Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="../6-conventions-and-code-style/6.4-es7-features.html">
            
                <a href="../6-conventions-and-code-style/6.4-es7-features.html">
            
                    
                    Speed up development with some and ES7 features ü§ò
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../7-testing/7.0-intro.html">
            
                <a href="../7-testing/7.0-intro.html">
            
                    
                    Testing and Debugging
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../7-testing/7.1-jest-setup.html">
            
                <a href="../7-testing/7.1-jest-setup.html">
            
                    
                    Jest setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../7-testing/7.2-snapshots.html">
            
                <a href="../7-testing/7.2-snapshots.html">
            
                    
                    Snapshots
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../7-testing/7.3-enzyme-testing.html">
            
                <a href="../7-testing/7.3-enzyme-testing.html">
            
                    
                    Testing stateful components using Enzyme
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.4" data-path="../7-testing/7.4-mocking-rn-modules.html">
            
                <a href="../7-testing/7.4-mocking-rn-modules.html">
            
                    
                    Mocking RN modules  
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../8-styling/8.0-intro.html">
            
                <a href="../8-styling/8.0-intro.html">
            
                    
                    Styling üíÖüèª
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../8-styling/8.1-theme-variables.html">
            
                <a href="../8-styling/8.1-theme-variables.html">
            
                    
                    Theme Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../8-styling/8.2-common-styles-mixins.html">
            
                <a href="../8-styling/8.2-common-styles-mixins.html">
            
                    
                    Common Styles/Mixins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.3" data-path="../8-styling/8.3-separating-styles-from-component.html">
            
                <a href="../8-styling/8.3-separating-styles-from-component.html">
            
                    
                    Separating styles from component
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../9-redux/9.0-intro.html">
            
                <a href="../9-redux/9.0-intro.html">
            
                    
                    Redux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="../9-redux/9.1-redux-setup.html">
            
                <a href="../9-redux/9.1-redux-setup.html">
            
                    
                    Redux setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.2" data-path="../9-redux/9.2-presentational-vs-containers.html">
            
                <a href="../9-redux/9.2-presentational-vs-containers.html">
            
                    
                    Presentational VS Containers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../10-navigation/10.0-intro.html">
            
                <a href="../10-navigation/10.0-intro.html">
            
                    
                    Navigation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.6.1" data-path="../10-navigation/10.1-using-react-navigation.html">
            
                <a href="../10-navigation/10.1-using-react-navigation.html">
            
                    
                    Using React-navigation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6.2" data-path="../10-navigation/10.2-integrating-with-redux-store.html">
            
                <a href="../10-navigation/10.2-integrating-with-redux-store.html">
            
                    
                    Integrating with redux store
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6.3" data-path="../10-navigation/10.3-file-structure-for-routes.html">
            
                <a href="../10-navigation/10.3-file-structure-for-routes.html">
            
                    
                    File Structure for routes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="11.0-devops.html">
            
                <a href="11.0-devops.html">
            
                    
                    DevOps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.7.1" data-path="11.1-android-build-setup.html">
            
                <a href="11.1-android-build-setup.html">
            
                    
                    Android Build setup
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.7.2" data-path="11.2-ios-build-setup.html">
            
                <a href="11.2-ios-build-setup.html">
            
                    
                    iOS Build setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7.3" data-path="11.3-ci-setup.md">
            
                <span>
            
                    
                    CI setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7.4" data-path="11.4-test-fairy-setup.md">
            
                <span>
            
                    
                    Test Fairy setup
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="../12-svg-icons-using-react-native-vector-icons/12.0-intro.html">
            
                <a href="../12-svg-icons-using-react-native-vector-icons/12.0-intro.html">
            
                    
                    SVG Icons using react-native-vector-icons
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.8.1" data-path="../12-svg-icons-using-react-native-vector-icons/12.1-creating-custom-iconset.html">
            
                <a href="../12-svg-icons-using-react-native-vector-icons/12.1-creating-custom-iconset.html">
            
                    
                    Custom Icon set
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="../13-internationalization/13.1-framework-intro.html">
            
                <a href="../13-internationalization/13.1-framework-intro.html">
            
                    
                    Internationalization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.9.1" data-path="../13-internationalization/13.2-language-toggle.html">
            
                <a href="../13-internationalization/13.2-language-toggle.html">
            
                    
                    Adding language toggle feature
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.2" data-path="../13-internationalization/13.3-integration-with-react-navigation.html">
            
                <a href="../13-internationalization/13.3-integration-with-react-navigation.html">
            
                    
                    Integration with react-navigation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.3" data-path="../15-third-party-components/15.1-when-should-i-search-for-pre-built-components.md">
            
                <span>
            
                    
                    When should I search for pre-built components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.4" data-path="../15-third-party-components/15.2-linking-components.md">
            
                <span>
            
                    
                    Linking components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.5" data-path="../15-third-party-components/15.3-recommended-components.md">
            
                <span>
            
                    
                    Recommended components
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="../16-custom-native-modules/16.0-intro.html">
            
                <a href="../16-custom-native-modules/16.0-intro.html">
            
                    
                    Custom Native Modules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.10.1" data-path="../16-custom-native-modules/16.1-android-native-module.html">
            
                <a href="../16-custom-native-modules/16.1-android-native-module.html">
            
                    
                    Android Native Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10.2" data-path="../16-custom-native-modules/16.2-ios-native-module.html">
            
                <a href="../16-custom-native-modules/16.2-ios-native-module.html">
            
                    
                    iOS Native Modules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >iOS Build setup</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="ios-build-scripts--setup-wip">iOS build scripts / setup [WIP]</h1>
<p>iOS builds via commandline are fairly much more complex as compared to android.</p>
<p>These are the few pre-requisites to build a release ipa file.</p>
<ul>
<li><strong>BUILD_NAME</strong> - The name that will be used by testers to identify the build, for example: &apos;1.1.1&apos;, &apos;1.0-alpha, etc.</li>
<li><strong>BUILD_NUMBER</strong> - A unique integer number identifying the build. This is used by android to identify which build is the updated build. This should be a integer number. for example : 1, 111, 111, etc.</li>
<li><strong>IOS_APP_ID</strong> - This is the unique app identifier which is used to identify the app uniquely in the app store or can be used to identify if the build is dev, pre prod or prod. These may look like these : com.app.notetaker-dev, com.app.notetaker-alpha.</li>
<li><strong>IOS_CERTIFICATE</strong> - This is the certificate file used to sign the app.</li>
<li><strong>IOS_CERTIFICATE_KEY</strong> - This is the certificate password used while creating the certificate.</li>
<li><strong>IOS_PROVISION_PROFILE</strong> - This is provision profile needed to build the app. This file mentions the capabilities / devices that are allowed to run the app.</li>
<li><strong>IOS_EXPORT_OPTIONS_PLIST</strong> - This is the options file needed to specify parameters for the build.</li>
<li><strong>IOS_SCHEME</strong> - The scheme which should be used to build the ipa. Typically we will have different schemes per environment. For example: we can have local, preprod and a production scheme.</li>
<li><strong>IOS_CONFIGURATION</strong> - This is the setting which specified if the build is DEBUG or RELEASE.</li>
<li><strong>PROJECT_NAME</strong> - This is name of the project for example if your project name inside ios folder says SampleProject.xcworkspace or SampleProject.xcodeproj, then PROJECT_NAME=SampleProject .</li>
</ul>
<p>Ideally every app has three release variants just like a typical backend application:</p>
<ul>
<li>Dev build - The app which connects to the staging/dev backend Environment. This can also have additional libraries like test fairy.</li>
<li>Pre Prod build - The app which points to pre prod backend environment.This is usually very similar, if not identical to  production app.</li>
<li>Prod build - The final ipa which should be released to the app store.</li>
</ul>
<p>Hence, we would need three different <code>schemes</code> for three different variants.</p>
<p>A typical build process in iOS would have following steps:</p>
<ol>
<li>Getting the certificates and provisioning profiles from apple developer account.</li>
<li>Adding the certificate to the default keychain and placing the provisioning profile at the location <code>~/Library/MobileDevice/Provisioning\ Profiles/</code></li>
<li>Archiving the project - Think of it as a executable zip of the project that can be run using XCode.</li>
<li>Exporting the IPA - Think of it as exporting the archive to a format recognised by the iPhone.</li>
</ol>
<p><strong>Lets get started</strong></p>
<ol>
<li>Place the provisioning profile at <code>scripts/ios/profile/XYZ.mobileprovision</code></li>
<li>Place the certificate at <code>scripts/ios/certs/ABC.p12</code></li>
<li><p>Place an exportOptions file at <code>scripts/ios/exportOptions/exportOptions-dev.plist</code>
Typically an exportOptions file looks like this :
<strong><code>scripts/ios/exportOptions/exportOptions-dev.plist</code></strong></p>
<pre><code class="lang-xml"> <span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
 <span class="hljs-meta">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">plist</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>compileBitcode<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">false</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>method<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>enterprise<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>teamID<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>ABC1234DA<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>uploadBitcode<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>uploadSymbols<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>manifest<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>appURL<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>null<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>displayImageURL<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>null<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>fullSizeImageURL<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>null<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">plist</span>&gt;</span>
</code></pre>
<p>Make sure you put all the <strong>above files</strong> in the git ignore.</p>
</li>
<li><p>Create the script:
The below script will create a new keychain <code>ios-build</code> and will store the certificate in the keychain. Also, it will make the keychain the default one so that the xcode picks up the certificate from the new keychain. Then it will copy the provisioning profile in the correct directory so that xcode picks it up.</p>
<p><strong><code>scripts/ios/keychain.sh</code></strong></p>
<pre><code class="lang-bash"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-built_in">set</span> <span class="hljs-_">-e</span>
cur_dir=`dirname <span class="hljs-variable">$0</span>`

<span class="hljs-comment">#Check if ios-build keychain exists</span>
<span class="hljs-built_in">export</span> keychainCount=`security list-keychains | grep -E <span class="hljs-string">&apos;ios-build&apos;</span> -c`

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$keychainCount</span> == 0 ] ; <span class="hljs-keyword">then</span>
 <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Create ios-build keychain&quot;</span>
 <span class="hljs-comment"># Create a custom keychain</span>
 security create-keychain -p <span class="hljs-string">&quot;ios-build-password&quot;</span> ios-build.keychain
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># Add it to the list</span>
security list-keychains <span class="hljs-_">-d</span> user <span class="hljs-_">-s</span> ios-build.keychain

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Making the ios-build keychain default ,so xcodebuild will use it for signing&quot;</span>
security default-keychain <span class="hljs-_">-s</span> ios-build.keychain

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Unlocking the ios-build keychain&quot;</span>
security unlock-keychain -p <span class="hljs-string">&quot;ios-build-password&quot;</span> ios-build.keychain

<span class="hljs-comment"># Set keychain timeout to 1 hour for long builds</span>
<span class="hljs-comment"># see http://www.egeek.me/2013/02/23/jenkins-and-xcode-user-interaction-is-not-allowed/</span>
security <span class="hljs-built_in">set</span>-keychain-settings -t 3600 <span class="hljs-_">-l</span> ~/Library/Keychains/ios-build.keychain

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Importing <span class="hljs-variable">$IOS_CERTIFICATE</span> to keychain&quot;</span>
security import <span class="hljs-variable">$cur_dir</span>/certs/<span class="hljs-variable">$IOS_CERTIFICATE</span> -k ~/Library/Keychains/ios-build.keychain -P <span class="hljs-variable">$IOS_CERTIFICATE_KEY</span> -T <span class="hljs-string">&quot;/usr/bin/codesign&quot;</span> -A

<span class="hljs-comment">#Mac OS Sierra https://stackoverflow.com/questions/39868578/security-codesign-in-sierra-keychain-ignores-access-control-settings-and-ui-p</span>
security <span class="hljs-built_in">set</span>-key-partition-list -S apple-tool:,apple: <span class="hljs-_">-s</span> -k <span class="hljs-string">&quot;ios-build-password&quot;</span> ios-build.keychain

<span class="hljs-comment"># Put the provisioning profile in place</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Coping <span class="hljs-variable">$IOS_PROVISION_PROFILE</span> in place&quot;</span>
mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
cp <span class="hljs-string">&quot;<span class="hljs-variable">$cur_dir</span>/profile/<span class="hljs-variable">$IOS_PROVISION_PROFILE</span>&quot;</span> ~/Library/MobileDevice/Provisioning\ Profiles/
</code></pre>
</li>
<li><p>Create the script that does the build.
This script will run the xcodebuild to first archive the project. Then it will generate the IPA file that can be used for installing the app onto an iPhone.
<strong><code>scripts/ios/builder.sh</code></strong></p>
<pre><code class="lang-sh"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-built_in">set</span> <span class="hljs-_">-e</span>
cur_dir=`dirname <span class="hljs-variable">$0</span>`

WORKING_DIR=`<span class="hljs-built_in">pwd</span>`;
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$cur_dir</span>/../../ios
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Setting version to <span class="hljs-variable">${BUILD_NUMBER}</span>, <span class="hljs-variable">${BUILD_NAME}</span>&quot;</span>
xcrun agvtool new-version -all <span class="hljs-variable">${BUILD_NUMBER}</span>
xcrun agvtool new-marketing-version <span class="hljs-variable">${BUILD_NAME}</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$WORKING_DIR</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Archiving the project&quot;</span>
xcodebuild clean archive PRODUCT_BUNDLE_IDENTIFIER=<span class="hljs-variable">${IOS_APP_ID}</span> -project <span class="hljs-variable">$cur_dir</span>/../../ios/<span class="hljs-variable">${PROJECT_NAME}</span>.xcodeproj -scheme <span class="hljs-variable">$IOS_SCHEME</span> -configuration <span class="hljs-variable">$IOS_CONFIGURATION</span> -derivedDataPath <span class="hljs-variable">$cur_dir</span>/../../ios/build -archivePath <span class="hljs-variable">$cur_dir</span>/../../ios/build/Products/<span class="hljs-variable">${PROJECT_NAME}</span>.xcarchive

<span class="hljs-comment"># or if you are not using xcodeproj and are using xcworkspace to build.. use the below code:</span>

<span class="hljs-comment"># echo &quot;Archiving the project&quot;</span>
<span class="hljs-comment"># xcodebuild clean archive PRODUCT_BUNDLE_IDENTIFIER=${IOS_APP_ID} -workspace $cur_dir/../../ios/${PROJECT_NAME}.xcworkspace -scheme $IOS_SCHEME -configuration $IOS_CONFIGURATION -derivedDataPath $cur_dir/../../ios/build -archivePath $cur_dir/../../ios/build/Products/${PROJECT_NAME}.xcarchive</span>

<span class="hljs-comment">#SIGN</span>
<span class="hljs-comment"># Issue : &quot;No applicable devices found.&quot;</span>
<span class="hljs-comment"># Fix: https://stackoverflow.com/questions/39634404/xcodebuild-exportarchive-no-applicable-devices-found</span>
<span class="hljs-built_in">unset</span> GEM_HOME
<span class="hljs-built_in">unset</span> GEM_PATH

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Export archive to create IPA file using <span class="hljs-variable">$IOS_EXPORT_OPTIONS_PLIST</span>&quot;</span>
xcodebuild -exportArchive -archivePath <span class="hljs-variable">$cur_dir</span>/../../ios/build/Products/<span class="hljs-variable">${PROJECT_NAME}</span>.xcarchive -exportOptionsPlist <span class="hljs-variable">$cur_dir</span>/../../scripts/ios/<span class="hljs-built_in">export</span>Options/<span class="hljs-variable">$IOS_EXPORT_OPTIONS_PLIST</span> -exportPath <span class="hljs-variable">$cur_dir</span>/../../ios/build/Products/IPA

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;IPA will be found at <span class="hljs-variable">$cur_dir</span>/../../ios/build/Products/IPA/<span class="hljs-variable">$IOS_SCHEME</span>.ipa&quot;</span>
</code></pre>
</li>
</ol>
<p><strong>Executing the scripts</strong></p>
<ol>
<li><p>Run the <code>keychain.sh</code> to setup the certificate and provision profile like this:
<code>IOS_CERTIFICATE=&apos;ABC.p12&apos; IOS_CERTIFICATE_KEY=&apos;PASSWORD&apos; IOS_PROVISION_PROFILE=&apos;ABC.mobileprovision&apos; sh scripts/ios/keychain.sh</code></p>
</li>
<li><p>Now, run the build script to build the ipa file like this:
<code>PROJECT_NAME=&apos;NoteTaker&apos; IOS_APP_ID=&apos;com.notetaker.app.ios&apos; BUILD_NUMBER=11 BUILD_NAME=1.1.1 IOS_SCHEME=&apos;local&apos; IOS_CONFIGURATION=&apos;RELEASE&apos; IOS_EXPORT_OPTIONS_PLIST=&apos;exportOptions-dev.plist&apos; sh ./scripts/ios/builder.sh</code></p>
</li>
</ol>
<p>The build should take couple of minutes and you can find the final ipa file at:
<code>ios/build/Products/IPA/</code></p>
<p><strong>Note: Build works only for Mac users:</strong>
Since apple requires that all the build be made on xcode itself, iOS apps can only be built on a mac machine.</p>
<p>The code till here can be found on the <strong>branch</strong> <code>chapter/11/11.2</code></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="11.1-android-build-setup.html" class="navigation navigation-prev " aria-label="Previous page: Android Build setup">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="11.3-ci-setup.md" class="navigation navigation-next " aria-label="Next page: CI setup">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"iOS Build setup","level":"2.7.2","depth":2,"next":{"title":"CI setup","level":"2.7.3","depth":2,"path":"11-devops/11.3-ci-setup.md","ref":"11-devops/11.3-ci-setup.md","articles":[]},"previous":{"title":"Android Build setup","level":"2.7.1","depth":2,"path":"11-devops/11.1-android-build-setup.md","ref":"11-devops/11.1-android-build-setup.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["-lunr","-search","search-plus","disqus","expo-snack","ga"],"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"rnMadeEasy"},"ga":{"configuration":"auto","token":"UA-XXXX-Y"},"search-plus":{},"expo-snack":{"myConfigKey":"it's the default value"},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"11-devops/11.2-ios-build-setup.md","mtime":"2017-12-05T02:44:03.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-12-09T15:03:09.280Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

